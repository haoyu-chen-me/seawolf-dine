<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    
    <title>Wolfie Dineã€€</title>
    
    <meta property="og:title" content="Wolfie Dine" />
    <meta property="og:site_name" content="Wolfie Dine" />
    <meta name="application-name" content="Wolfie Dine" />
    <meta name="apple-mobile-web-app-title" content="Wolfie Dine" />
    <meta name="description" content="Daily menus, hours, and live updates.">
    <link rel="canonical" href="https://www.wolfiedine.com/">

    <link rel="apple-touch-icon" href="https://www.wolfiedine.com/apple-touch-icon.png">
    <link rel="icon" href="https://www.wolfiedine.com/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="16x16" href="https://www.wolfiedine.com/wolfiedine_icon_16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://www.wolfiedine.com/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="https://www.wolfiedine.com/wolfiedine_icon_48.png">
    <link rel="icon" type="image/png" sizes="192x192" href="https://www.wolfiedine.com/wolfiedine_icon_192.png">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        html { font-size: 14px; /* è¿›ä¸€æ­¥è°ƒå°åŸºå‡†å­—å· */ }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #ffcdd2 0%, #ffebee 100%);
            min-height: 100vh;
            color: #333;
            -webkit-tap-highlight-color: transparent;
        }

        header {
            background: linear-gradient(135deg, #b71c1c 0%, #c62828 100%);
            color: white;
            padding: 0.5rem 0; /* æç®€å¤´éƒ¨ */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 0.8rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 1.2rem; /* æ ‡é¢˜æ›´å° */
            font-weight: 700;
            letter-spacing: -0.5px;
            margin: 0;
        }
        
        .tagline { display: none; /* æ‰‹æœºç«¯éšè—å‰¯æ ‡é¢˜çœç©ºé—´ */ }
        @media (min-width: 600px) { .tagline { display: block; font-size: 0.8rem; opacity: 0.9; } }

        .clock-container { text-align: right; }
        .clock-time { font-size: 1.1rem; font-weight: 700; line-height: 1; }
        .clock-date { font-size: 0.65rem; opacity: 0.9; }

        nav {
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            position: sticky;
            top: 0; 
            z-index: 999;
        }

        .nav-container {
            padding: 0 0.5rem;
            display: flex;
            justify-content: center;
            gap: 0.5rem;
        }

        .nav-btn {
            background: none;
            border: none;
            padding: 0.6rem 0.8rem;
            font-size: 0.9rem;
            font-weight: 600;
            color: #c62828;
            cursor: pointer;
            text-decoration: none;
        }

        .nav-btn.active { border-bottom: 2px solid #c62828; }

        main {
            max-width: 100%;
            margin: 0 auto;
            padding: 0.5rem; /* æå°è¾¹è· */
        }
        
        @media (min-width: 768px) { main { padding: 1rem 2rem; } }

        .page { display: none; }
        .page.active { display: block; }

        .meal-selector {
            background: #fff;
            border-radius: 12px;
            padding: 0.8rem 0.5rem;
            margin-bottom: 0.8rem;
            box-shadow: 0 2px 8px rgba(0,0,0,.05);
            text-align: center;
        }

        .meal-selector h2 {
            color: #9b1111;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            font-weight: 750;
        }

        .meal-buttons {
            display: flex;
            justify-content: center;
            gap: 0.4rem;
            flex-wrap: wrap;
        }

        .meal-btn {
            background: #f2f3f5;
            color: #30343a;
            padding: 0.4rem 0.6rem;
            border-radius: 8px;
            cursor: pointer;
            border: 1px solid transparent;
            text-align: center;
            line-height: 1;
            /* æŒ‰é’®æ›´ç´§å‡‘ */
            flex: 1; 
            min-width: 70px; 
            max-width: 100px;
        }
        
        .meal-btn.active {
            background: #b11212;
            color: #fff;
            box-shadow: 0 2px 6px rgba(177,18,18,.2);
        }
        
        .meal-label { font-size: 0.85rem; font-weight: 700; display: block; margin-bottom: 2px; }
        .meal-time { font-size: 0.65rem; opacity: 0.8; font-weight: 500; }

        /* --- æ ¸å¿ƒä¿®æ”¹ï¼šè¶…ç´§å‡‘å¤šåˆ—å¸ƒå±€ --- */
        .dining-halls {
            display: grid;
            /* æ‰‹æœºé»˜è®¤3åˆ— */
            grid-template-columns: repeat(3, 1fr); 
            gap: 0.4rem; /* æå°é—´è· */
            margin-top: 0.5rem;
        }

        /* ç¨å¤§ä¸€ç‚¹çš„æ‰‹æœºï¼ˆå¦‚Pro Maxï¼‰æˆ–æ¨ªå±ï¼Œæ˜¾ç¤º4åˆ— */
        @media (min-width: 450px) {
            .dining-halls { grid-template-columns: repeat(4, 1fr); }
        }
        
        /* å¹³æ¿æˆ–ç”µè„‘æ˜¾ç¤ºæ›´å¤šåˆ— */
        @media (min-width: 800px) {
            .dining-halls { grid-template-columns: repeat(5, 1fr); gap: 1rem; }
        }

        .dining-hall {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            /* å›ºå®šé«˜åº¦ï¼Œä¿è¯æ•´é½ï¼ŒåƒAPPå›¾æ ‡ä¸€æ · */
            height: 220px; 
        }

        .hall-header {
            background: #c62828;
            color: white;
            padding: 0.4rem 0.2rem;
            text-align: center;
            /* å¤´éƒ¨é«˜åº¦å›ºå®š */
            height: 45px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .hall-header h3 { 
            font-size: 0.8rem; /* æ ‡é¢˜æå° */
            margin: 0;
            line-height: 1.1;
            /* è¶…è¿‡ä¸¤è¡Œçœç•¥ */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .hall-status {
            display: none; /* æç®€æ¨¡å¼ä¸‹éšè—çŠ¶æ€æ¡ï¼Œå¤ªå åœ°äº†ï¼Œæˆ–è€…å­—æå° */
        }

        .menu-content {
            padding: 0.3rem;
            overflow-y: auto;
            flex-grow: 1;
            /* éšè—æ»šåŠ¨æ¡ä½†å…è®¸æ»šåŠ¨ */
            scrollbar-width: none; 
        }
        .menu-content::-webkit-scrollbar { display: none; }

        .menu-category { margin-bottom: 0.4rem; }

        .category-title {
            color: #c62828;
            font-size: 0.75rem;
            font-weight: 700;
            margin-bottom: 0.2rem;
            padding-bottom: 0.1rem;
            border-bottom: 1px solid #eee;
            /* åªæ˜¾ç¤ºä¸€è¡Œ */
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis;
        }

        .category-icon { display: none; /* çœç•¥å›¾æ ‡çœç©ºé—´ */ }

        .menu-items { list-style: none; }

        .menu-item {
            padding: 0.15rem 0;
            font-size: 0.7rem; /* èœå•å†…å®¹å­—å·æå° */
            line-height: 1.2;
            color: #444;
            border-bottom: 1px dashed #f5f5f5;
        }
        
        .menu-item-link { color: inherit; text-decoration: none; display: block; }

        .no-menu { font-size: 0.7rem; color: #999; text-align: center; padding-top: 1rem; }
        
        .last-updated { font-size: 0.6rem; color: #aaa; text-align: center; margin-top: 0.5rem; display: none; }

        /* å…³äºé¡µé¢ä¿æŒåŸæ · */
        .about-content { padding: 1.5rem; background: white; border-radius: 12px; }
        .about-content h2 { font-size: 1.5rem; margin-bottom: 1rem; color: #c62828; }
        
        footer { text-align: center; padding: 1.5rem; color: #fff; font-size: 0.75rem; }
    </style>

    <script defer src="https://static.cloudflareinsights.com/beacon.min.js"
      data-cf-beacon='{"token": "b55eeac22b1c465d9a39541f96cbcdae"}'></script>

</head>

<body>
    <header>
        <div class="header-container">
            <div class="header-left">
                <h1>ğŸº Wolfie Dine</h1>
                <p class="tagline">Campus dining</p>
            </div>
            <div class="clock-container">
                <div class="clock-time" id="clock-time">00:00</div>
                <div class="clock-date" id="clock-date">...</div>
            </div>
        </div>
    </header>

    <nav>
        <div class="nav-container">
            <button class="nav-btn active" onclick="showPage('menu', this)">Menu</button>
            <button class="nav-btn" onclick="showPage('about', this)">About</button>
            <a class="nav-btn" href="https://docs.google.com/forms/d/e/1FAIpQLSfwXXeb2SHBLBE1TENjznsm8F5WlA5zCsay5n1cbmbJU2BTIQ/viewform?usp=sharing&ouid=114715764942658548801" target="_blank">Feedback</a>
        </div>
    </nav>

    <main>
        <div id="menu-page" class="page active">
            <div class="meal-selector">
                <h2 id="meal-selector-title">Meals</h2>
                <div class="meal-buttons" id="meal-buttons"></div>
            </div>
            <div class="dining-halls" id="dining-halls-container"></div>
        </div>

        <div id="about-page" class="page">
            <div class="about-content">
                <h2>About</h2>
                <p>Wolfie Dine aggregates Stony Brook dining menus.</p>
                <p>Maintained by students. Updates daily.</p>
                <p><a href="https://stonybrook.nutrislice.com" target="_blank">Official Site</a></p>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2026 Wolfie Dine</p>
    </footer>

    <script>
        /* è¿™é‡Œæ˜¯æ•°æ®æºåŒºåŸŸ
           æœªæ¥ä½ è¦åŠ 10ä¸ªé¤å…ï¼Œåªéœ€è¦åœ¨è¿™é‡Œå¤åˆ¶ç²˜è´´ 'new-hall': {...} å³å¯
           é¡µé¢ä¼šè‡ªåŠ¨æ’åˆ—å®ƒä»¬
        */
        const menuData = {
            'west-hall': { name: 'West Side', isDynamic: true },
            'east-hall': { name: 'East Side', isDynamic: true },
            'dental-cafe': { name: 'Dental CafÃ©', isDynamic: true },
            // ç¤ºä¾‹ï¼šæœªæ¥åŠ çš„é¤å…
            // 'roth-cafe': { name: 'Roth CafÃ©', isDynamic: false },
            // 'jasmine': { name: 'Jasmine', isDynamic: false },
        };

        if (!menuData['west-hall'].isDynamic) {
            menuData['west-hall'].latenight = menuData['west-hall'].dinner;
        }

        let dentalCafeData = null;
        let eastDiningData = null;
        let westDiningData = null;

        const categoryIcons = {
            'Breakfast Classics': '', 'Hot Breakfast': '', 'Healthy Options': '',
            'Continental': '', 'Beverages': '', 'Entrees': '', 'Sides': '',
            'Soups': '', 'Desserts': '', 'All Items': ''
        };

        let currentMeal = 'breakfast';

        function pickInitialMeal() {
            const now = new Date();
            const day = now.getDay();
            const minutes = now.getHours() * 60 + now.getMinutes();
            const isWeekend = (day === 0 || day === 6);
            const schedule = isWeekend ? [
                { key: 'lunch', label: 'Brunch', time: '9a-4p', start: 540, end: 960 },
                { key: 'dinner', label: 'Dinner', time: '4p-11p', start: 960, end: 1380 }
            ] : [
                { key: 'breakfast', label: 'Bkfst', time: '7:30a', start: 450, end: 660 },
                { key: 'lunch', label: 'Lunch', time: '11a', start: 660, end: 960 },
                { key: 'dinner', label: 'Dinner', time: '4p', start: 960, end: 1320 },
                { key: 'late-night', label: 'Late', time: '10p', start: 1320, end: 1440 }
            ];
            for (const slot of schedule) {
                if (minutes >= slot.start && minutes < slot.end) return slot.key;
            }
            for (const slot of schedule) {
                if (minutes < slot.start) return slot.key;
            }
            return schedule[0].key;
        }

        function applyMealSchedule() {
            const now = new Date();
            const day = now.getDay();
            const isWeekend = (day === 0 || day === 6);
            const schedule = isWeekend ? [
                { key: 'lunch', label: 'Brunch', time: '9a-4p' },
                { key: 'dinner', label: 'Dinner', time: '4p-11p' }
            ] : [
                { key: 'breakfast', label: 'Bkfst', time: '7:30a' },
                { key: 'lunch', label: 'Lunch', time: '11a' },
                { key: 'dinner', label: 'Dinner', time: '4p' },
                { key: 'late-night', label: 'Late', time: '10p' }
            ];

            const buttonsWrap = document.getElementById('meal-buttons');
            buttonsWrap.innerHTML = schedule.map(slot => `
                <button class="meal-btn" data-meal="${slot.key}">
                    <span class="meal-label">${slot.label}</span>
                    <span class="meal-time">${slot.time}</span>
                </button>
            `).join('');

            buttonsWrap.querySelectorAll('.meal-btn').forEach(btn => {
                btn.addEventListener('click', () => changeMeal(btn.dataset.meal));
            });
        }

        function setInitialMealUI(initialMeal) {
            currentMeal = initialMeal;
            document.querySelectorAll('.meal-btn').forEach(btn => btn.classList.remove('active'));
            const chosenBtn = document.querySelector(`[data-meal="${initialMeal}"]`);
            if (chosenBtn) chosenBtn.classList.add('active');
            renderDiningHalls();
        }

        /* Data Fetching Functions (No changes in logic, just compact rendering) */
        async function loadDentalCafeData() {
            try {
                const response = await fetch('dental_cafe.json?ts=' + Date.now());
                if (!response.ok) throw new Error('Err');
                dentalCafeData = await response.json();
            } catch (error) {
                dentalCafeData = { status: 'error', menu: [] };
            } finally { renderDiningHalls(); }
        }

        async function loadEastDiningData() {
            try {
                const response = await fetch('east_dining.json?ts=' + Date.now());
                if (!response.ok) throw new Error('Err');
                eastDiningData = await response.json();
            } catch (error) {
                eastDiningData = { status: 'error', meals: {} };
            } finally { renderDiningHalls(); }
        }

        async function loadWestDiningData() {
            try {
                const response = await fetch('west_dining.json?ts=' + Date.now());
                if (!response.ok) throw new Error('Err');
                westDiningData = await response.json();
            } catch (error) {
                westDiningData = { status: 'error', meals: {} };
            } finally { renderDiningHalls(); }
        }

        function updateClock() {
            const now = new Date();
            const h = String(now.getHours()).padStart(2, '0');
            const m = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('clock-time').textContent = `${h}:${m}`;
            
            const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
            const mths = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
            document.getElementById('clock-date').textContent = `${days[now.getDay()]}, ${mths[now.getMonth()]} ${now.getDate()}`;
        }
        setInterval(updateClock, 1000); updateClock();

        function showPage(pageName, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`${pageName}-page`).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function getUrl(type, dateStr) {
            const baseMap = {
                'dental': "https://stonybrook.nutrislice.com/menu/sbu-eats-events/dental-cafe",
                'east': "https://stonybrook.nutrislice.com/menu/east-side-dining/todays-dine-in-specials-esd",
                'west': "https://stonybrook.nutrislice.com/menu/west-side-dining/todays-dine-in-specials-wsd"
            };
            let url = baseMap[type];
            if(dateStr) url += `?day=${encodeURIComponent(dateStr)}`;
            return url;
        }

        /* --- Rendering Logic for Compact View --- */

        function renderDentalCafeContent() {
            if (!dentalCafeData) return '<div class="no-menu">...</div>';
            const menu = dentalCafeData.menu || [];
            if (menu.length === 0) return '<div class="no-menu">Closed</div>';

            const dateStr = dentalCafeData.date || null;
            const href = getUrl('dental', dateStr);

            return `
                <div class="menu-category">
                    <h4 class="category-title">Menu</h4>
                    <ul class="menu-items">
                        ${menu.map(item => `
                            <li class="menu-item">
                                <a class="menu-item-link" href="${href}" target="_blank">${item.name}</a>
                            </li>`).join('')}
                    </ul>
                </div>`;
        }

        function renderNutrisliceContent(data, type) {
            if (!data) return '<div class="no-menu">...</div>';
            const meals = data.meals || {};
            let mealKey = currentMeal === 'late-night' ? 'late_night' : currentMeal;
            
            if (data.is_weekend) {
                if (mealKey === 'lunch' || mealKey === 'breakfast') mealKey = 'brunch';
                if (mealKey === 'late_night') mealKey = 'dinner';
            }

            const blocks = meals[mealKey] || [];
            if (blocks.length === 0) return '<div class="no-menu">Closed</div>';

            const dateStr = data.date || null;
            const href = getUrl(type, dateStr);

            return blocks.map(b => `
                <div class="menu-category">
                    <h4 class="category-title">${b.section || 'Menu'}</h4>
                    <ul class="menu-items">
                        ${(b.items || []).map(name => `
                            <li class="menu-item">
                                <a class="menu-item-link" href="${href}" target="_blank">${name}</a>
                            </li>`).join('')}
                    </ul>
                </div>
            `).join('');
        }

        function renderDiningHalls() {
            const container = document.getElementById('dining-halls-container');
            container.innerHTML = '';

            Object.keys(menuData).forEach(hallId => {
                const hall = menuData[hallId];
                const hallDiv = document.createElement('div');
                hallDiv.className = 'dining-hall';

                let content = '<div class="no-menu">N/A</div>';
                
                if (hall.isDynamic) {
                    if (hallId === 'dental-cafe') content = renderDentalCafeContent();
                    else if (hallId === 'east-hall') content = renderNutrisliceContent(eastDiningData, 'east');
                    else if (hallId === 'west-hall') content = renderNutrisliceContent(westDiningData, 'west');
                } else {
                    // Future static halls
                    content = '<div class="no-menu">Coming Soon</div>';
                }

                hallDiv.innerHTML = `
                    <div class="hall-header">
                        <h3>${hall.name}</h3>
                    </div>
                    <div class="menu-content">${content}</div>
                `;
                container.appendChild(hallDiv);
            });
        }

        function changeMeal(meal) {
            currentMeal = meal;
            document.querySelectorAll('.meal-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`[data-meal="${meal}"]`)?.classList.add('active');
            renderDiningHalls();
        }

        applyMealSchedule();
        setInitialMealUI(pickInitialMeal());
        loadDentalCafeData();
        loadEastDiningData();
        loadWestDiningData();
    </script>
</body>
</html>
